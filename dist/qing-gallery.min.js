/* qing-gallery v0.0.1 | (c) Mycolorway Design | MIT License */
!function(t,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("qing-module")):t.QingGallery=e(t.jQuery,t.QingModule)}(this,function(t,e){var i=require=function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var i=e[s][1][t];return n(i?i:t)},p,p.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(i,r,n){var o,s=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=function(e){function i(e){this.el=t(e.el),this.thumb={src:this.el.attr("src"),size:{width:this.el.width(),height:this.el.height()}},this.origin={src:this.el.data("origin-src"),size:this._getOriginSize(),download:this.el.data("download-src"),name:this.el.data("origin-name")||this.el.attr("alt")||""},this.el.data("imageItem",this)}return s(i,e),i.prototype._getOriginSize=function(){var t;return t=this.el.data("origin-size"),t=t?t.split(","):[0,0],{width:1*t[0]||10*this.thumb.size.width,height:1*t[1]||10*this.thumb.size.height}},i}(e),r.exports=o},{}],2:[function(i,r,n){var o,s=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=function(e){function i(e){this.qingGallery=e,this.el=t(i._tpl).addClass("control-"+this.name).find(".name").text(e.opts.locales[this.name]).end().appendTo(e.preview.controls.find(".controls")),this._bind()}return s(i,e),i._tpl='<a class="control" href="javascript:;">\n  <span class="name"></span>\n</a>',i.prototype._bind=function(){return"need to implement"},i}(e),r.exports=o},{}],3:[function(t,e,i){var r,n,o=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./control.coffee"),n=function(t){function e(t){e.__super__.constructor.apply(this,arguments),this.el.attr("target","_blank")}return o(e,t),e.prototype.name="download",e.prototype.load=function(t){return t.origin.download?this.el.show().attr("href",t.origin.download):this.el.hide()},e}(r),e.exports=n},{"./control.coffee":2}],4:[function(t,e,i){var r,n,o,s=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=t("./control.coffee"),o=t("../utils.coffee"),n=function(t){function e(t){e.__super__.constructor.apply(this,arguments),this.degree=0}return s(e,t),e.prototype.name="rotate",e.prototype._bind=function(){return this.el.on("click",function(t){return function(){return t.rotateTo(t.degree+90)}}(this))},e.prototype.reset=function(){if(this.qingGallery.preview.imageItem)return this.rotateTo(this.degree-this.degree%360)},e.prototype.rotateTo=function(t){return this.degree=t,this.qingGallery.preview.frame.css(this._rotateFitSize()).css({transform:"rotate("+this.degree+"deg)"})},e.prototype._rotateFitSize=function(){var t,e,i;return t=this.degree/90%2===1,e=this.qingGallery.preview.imageItem.origin.size,t&&(e={width:e.height,height:e.width}),i=o.fitSize({width:this.qingGallery.preview.stage.width(),height:this.qingGallery.preview.stage.height()},e),t&&(i={width:i.height,height:i.width}),i},e}(r),e.exports=n},{"../utils.coffee":6,"./control.coffee":2}],5:[function(t,e,i){var r,n,o=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./control.coffee"),n=function(t){function e(t){e.__super__.constructor.apply(this,arguments),this.el.attr("target","_blank")}return o(e,t),e.prototype.name="source",e.prototype.load=function(t){return this.el.attr("href",t.origin.src)},e}(r),e.exports=n},{"./control.coffee":2}],6:[function(e,i,r){var n;n={preloadImages:function(e,i){var r,n,o,s,a,l,c;if((r=arguments.callee).loadedImages||(r.loadedImages={}),a=arguments.callee.loadedImages,"[object String]"===Object.prototype.toString.call(e))e=[e];else if("[object Array]"!==Object.prototype.toString.call(e))return!1;for(e=t.unique(e),l=[],n=0,s=e.length;n<s;n++)c=e[n],!a[c]||i?(o=new Image,t.isFunction(i)&&(o.onload=function(){return a[c]=!0,i(o)},o.onerror=function(){return i()}),l.push(o.src=c)):l.push(void 0);return l},transitionEnd:function(){var t,e,i;t=document.createElement("fakeelement"),i={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]},fitSize:function(t,e){return e.width<=t.width&&e.height<=t.height?e:e.width/e.height>t.width/t.height?{width:t.width,height:t.width*e.height/e.width}:{height:t.height,width:t.height*e.width/e.height}}},i.exports=n},{}],7:[function(i,r,n){var o,s,a=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=i("../utils.coffee"),o=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return a(i,e),i.opts={imageItems:null,selected:null},i._tpl='<div class="qing-gallery-list"></div>',i._imageItem='<a class="thumb" href="javascript:;"><img src="" /></a>',i.prototype._setOptions=function(e){return i.__super__._setOptions.apply(this,arguments),t.extend(this.opts,i.opts,e)},i.prototype._init=function(){if(this._render(),this._bind(),this.opts.imageItems.length<=1)return this.el.hide()},i.prototype._bind=function(){return this.el.on("click.qing-gallery",".thumb",function(e){return function(i){return e.select(t(i.currentTarget))}}(this))},i.prototype.select=function(e){var i;return null==e&&(e=t(this.el.find(".selected"))),i=e.data("imageItem"),e.addClass("selected").siblings(".selected").removeClass("selected"),this._scrollToSelected(),this.el.css("opacity",1),this.trigger("imageItemChange",[i]),!1},i.prototype._render=function(){return this.el=t(i._tpl),this.el.append(this.opts.imageItems.map(function(e){return function(r){var n;return n=t(i._imageItem).find("img").attr("src",r.thumb.src).end().data("imageItem",r),r===e.opts.selected&&n.addClass("selected"),n}}(this))),s.preloadImages(this.opts.imageItems.map(function(t){return t.origin.src}))},i.prototype.prev=function(){var t;return t=this.el.find(".selected").prev(),t.length||(t=this.el.find(".thumb:last")),t.click()},i.prototype.next=function(){var t;return t=this.el.find(".selected").next(),t.length||(t=this.el.find(".thumb:first")),t.click()},i.prototype._scrollToSelected=function(){var e,i,r;if(e=this.el.find(".selected"),r=e.offset(),i=t(document).scrollTop(),!(r.top<=i+t(window).height()-e.outerHeight()&&r.top>=i))return this.el.scrollTop(this.el.scrollTop()+r.top-i-parseInt(e.css("marginTop")))},i.prototype.destroy=function(){return this.el.css("opacity",0)},i}(e),r.exports=o},{"../utils.coffee":6}],8:[function(i,r,n){var o,s,a=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=i("../utils.coffee"),o=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return a(i,e),i._tpl='<div class="qing-gallery-preview">\n  <div class="qing-gallery-stage loading">\n    <div class="frame">\n      <img src="" />\n      <div class="loading-indicator"></div>\n    </div>\n  </div>\n  <div class="qing-gallery-controls">\n    <span class="filename"></span>\n    <div class="controls"></div>\n  </div>\n</div>',i.prototype._init=function(){return this.el=t(i._tpl),this._render(),this._bind()},i.prototype._render=function(){return this.controls=this.el.find(".qing-gallery-controls"),this.stage=this.el.find(".qing-gallery-stage"),this.frame=this.stage.find(".frame"),this.img=this.stage.find("img")},i.prototype._bind=function(){return this.stage.on("click.qing-gallery",function(e){return function(i){if(t(i.target).is(t(i.currentTarget)))return e.trigger("modalClick")}}(this))},i.prototype.init=function(t){return this.frame.css(this._frameInitialPos(t)).css(t.thumb.size),this.img.attr("src",t.thumb.src)},i.prototype.load=function(t){return this.frame.addClass("animate").css({left:0,top:0}).css(s.fitSize({width:this.stage.width(),height:this.stage.height()},t.origin.size)),this.img.attr("src",t.thumb.src),this.controls.css("opacity",1),this.el.find(".filename").text(t.origin.name),this.frame.addClass("loading"),s.preloadImages(t.origin.src,function(t){return function(e){if(e&&e.src)return t.img.attr("src",e.src),t.frame.removeClass("loading")}}(this)),this.imageItem=t},i.prototype._frameInitialPos=function(e){var i,r;return i=t(document),r=e.el.offset(),{top:2*(r.top-i.scrollTop()-(this.stage.outerHeight()-e.el.height())/2),left:2*(r.left-i.scrollLeft()-(this.stage.outerWidth()-e.el.width())/2)}},i.prototype.destroy=function(){return this.controls.css("opacity",0),this.frame.css(this.imageItem.thumb.size).css(this._frameInitialPos(this.imageItem)),this.frame.one(s.transitionEnd(),function(t){return function(e){return t.trigger("destroy")}}(this))},i}(e),r.exports=o},{"../utils.coffee":6}],"qing-gallery":[function(i,r,n){var o,s,a,l,c,p,u,h=function(t,e){function i(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},f={}.hasOwnProperty;l=i("./views/preview.coffee"),a=i("./views/list.coffee"),s=i("./models/image-item.coffee"),p=i("./plugins/rotate.coffee"),o=i("./plugins/download.coffee"),u=i("./plugins/source.coffee"),c=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return h(i,e),i.opts={el:null,appendTo:"body",scopeSelector:"",matchSelector:"",plugins:["rotate","download","source"],locales:{rotate:"Rotate",download:"Download",source:"Source"}},i.prototype._setOptions=function(e){return i.__super__._setOptions.call(this),t.extend(this.opts,i.opts,e)},i.prototype._init=function(){if(this.el=t(this.opts.el),!(this.el.length>0))throw new Error("QingGallery: option el is required");return i.destroyAll(),this._render(),this._bind(),this.preview.init(this.el.data("imageItem")),this.list.select()},i.prototype._render=function(){return this.imageItems=this.el.closest(this.opts.scopeSelector).find(this.opts.matchSelector).add(this.el).map(function(){return new s({el:this})}).get(),this.preview=new l,this.list=new a({imageItems:this.imageItems,selected:this.el.data("imageItem")}),this.wrapper=t('<div class="qing-gallery init-animation"></div>').data("qingGallery",this).append([this.preview.el,this.list.el]).appendTo(this.opts.appendTo),t("html").addClass("qing-gallery-active"),this.el.data("qingGallery",this)},i.prototype._bind=function(){return this.list.on("imageItemChange",function(t){return function(e,i){return t.plugins.rotate.reset(),t.plugins.download.load(i),t.plugins.source.load(i),t.preview.load(i),t.wrapper.addClass("modal")}}(this)),this.preview.on("modalClick",function(t){return function(){return t.destroy()}}(this)),t(document).on("keydown.qing-gallery",function(t){return function(e){return/27|32/.test(e.which)?(t.destroy(),!1):/37|38/.test(e.which)?(t.list.prev(),!1):/39|40/.test(e.which)?(t.list.next(),!1):void 0}}(this))},i.prototype.destroy=function(){return this.plugins.rotate.reset(),this.list.off("imageItemChange"),this.preview.off("modalClick"),t(document).off(".qing-gallery"),this.wrapper.removeClass("init-animation modal").addClass("destroy-animation"),this.list.destroy(),this.preview.one("destroy",function(e){return function(){return e.wrapper.remove(),e.el.removeData("qingGallery"),t("html").removeClass("qing-gallery-active"),e.trigger("destroy")}}(this)),this.preview.destroy()},i.destroyAll=function(){return t(".qing-gallery").each(function(){var e;return null!=(e=t(this).data("qingGallery"))?e.destroy():void 0})},i}(e),c.plugin("rotate",p),c.plugin("download",o),c.plugin("source",u),r.exports=c},{"./models/image-item.coffee":1,"./plugins/download.coffee":3,"./plugins/rotate.coffee":4,"./plugins/source.coffee":5,"./views/list.coffee":7,"./views/preview.coffee":8}]},{},[]);return i("qing-gallery")});